<head>
    <style>
       html,
       body,
       #map {
        height: 100%;
        width: 100%;
        margin: 0px;
        padding: 0px;
       }
    </style>
</head>
<body>

<h1> Welcome to your FoodEh profile <%= current_user.first_name %>! </h1>


<h2> Your Favorite Recipes </h2>

   <% current_user.favorites.each do |favorite| %>
    <li><%=link_to favorite.recipe.name, favorite_path(favorite.id)%></li>
   <br>
   <% end %>

<h2> Your Grocery List </h2>
   <% current_user.list.ingredients.each do |i|%>
    <li><%= i.description %></li>
   <% end %>

<h2> Grocery Stores Nearby </h2>
   <div id="map"></div>

<script>
  var map;
  var currentLocation;
  var geoLocOptions = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
  };

  function initMap() {
  map = new google.maps.Map(
    document.getElementById("map"), {
      center: new google.maps.LatLng(37.4419, -122.1419),
      zoom: 13,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    navigator.geolocation.getCurrentPosition(function(position) {
      var coords = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      map.setOptions({
        center: coords,
        zoom: 15
      });

    infowindow = new google.maps.InfoWindow();
    var service = new
google.maps.places.PlacesService(map);
    service.nearbySearch({
      location: coords,
      radius: 1000,
      type: ['grocery_or_supermarket']
    }, callback);
  }, errorHandler, geoLocOptions);
}
google.maps.event.addDomListener(window, "load", initMap);

  function errorHandler(err) {
    console.warn('ERROR(' + err.code + '): ' + err.message);
  };

  function callback(results, status){
      if (status === google.maps.places.PlacesServiceStatus.OK){
          for (var i =0; i < results.length; i++){
              createMarker(results[i]);
          }

      }
  }

  function createMarker(place){
      var placeLoc = place.geometry.location;
      var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
      });

      google.maps.event.addListener(marker, 'click' , function (){
          infowindow.setContent(place.name);
          infowindow.open(map , this);
      });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAACzznGlFwpHO83N9U4Pzz7g46dSbE-uo&libraries=places&callback=initMap">
</script>
</body>
