<head>
    <style>
       html,
       body {
         height: 100%;
         width: 100%;
       }

       #map {
        height: 600px;
        width: 80%;
        margin: 0px;
        padding-left: 0px;
       }
    </style>
</head>
<body>
  <div class="site-header"></div>

<h1> Welcome to your FoodEh profile, <%= current_user.first_name %>! </h1>



<h2 class="user-favorites-title"> Your Favorite Recipes </h2>

<div class="user-favorites">
   <% current_user.favorites.each do |favorite| %>
    <li><%=link_to favorite.recipe.name, favorite_path(favorite.id)%></li>
   <br>
   <% end %>
</div>

<h2 class="user-list-title"> Your Grocery List </h2>

    <div class="user-list">
     <% if current_user.list == nil %>
        <%= "No Ingredients Selected." %>
     <% elsif current_user.list.ingredients.empty? %>
        <%= "No Ingredients Selected." %>
     <% else %>
     <% current_user.list.ingredients.each do |ingredient| %>
       <li class="ingredients-user-page"><%= ingredient.description %>
       <%= form_for(ingredient, url: list_destroy_ingredient_url(ingredient), html:{method: "delete"}) do |f| %>
         <%= f.submit "Delete Ingredient" %>
         <%= f.hidden_field(:ingredient_id, value: ingredient.id)%></li>
       <% end %>
     <% end %>
     <% end %>
   </div>

</br>
</br>
<h2 class="map-topper"> Grocery Stores Nearby </h2>
   <div id="map"></div>

<script>
  var map;
  var currentLocation;
  var geoLocOptions = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
  };

  function initMap() {
  map = new google.maps.Map(
    document.getElementById("map"), {
      center: new google.maps.LatLng(43, -79),
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    navigator.geolocation.getCurrentPosition(function(position) {
      var coords = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      map.setOptions({
        center: coords,
        zoom: 15
      });

    infowindow = new google.maps.InfoWindow();
    var service = new
    google.maps.places.PlacesService(map);
    service.nearbySearch({
      location: coords,
      radius: 1000,
      type: ['grocery_or_supermarket']
    }, callback);
  }, errorHandler, geoLocOptions);
}
  google.maps.event.addDomListener(window, "load", initMap);




  function errorHandler(err) {
    console.warn('ERROR(' + err.code + '): ' + err.message);
  };

  function callback(results, status){
      if (status === google.maps.places.PlacesServiceStatus.OK){
          for (var i =0; i < results.length; i++){
              createMarker(results[i]);
          }

      }
  }

  function createMarker(place){
      var placeLoc = place.geometry.location;
      var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
      });

      google.maps.event.addListener(marker, 'click' , function (){
          infowindow.setContent(place.name);
          infowindow.open(map , this);
      });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAACzznGlFwpHO83N9U4Pzz7g46dSbE-uo&libraries=places&callback=initMap">
</script>
</body>
